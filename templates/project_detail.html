<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Details</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h1 class="text-center">Project Details</h1>
        <a href="/" class="btn btn-secondary mb-3">Back to Projects</a>

        <div class="card p-3 mb-4">
            <h3>{{ project.name }}</h3>
            <p><strong>Job Number:</strong> {{ project.job_number }}</p>
            <p><strong>Superintendent:</strong> {{ project.superintendent }}</p>
            <p><strong>Project Manager:</strong> {{ project.manager }}</p>
            <p><strong>Location:</strong> {{ project.location }}</p>
            <p><strong>Bid Contract Cost:</strong> ${{ project.bid_cost }}</p>
            <p><strong>Bid Contract Value:</strong> ${{ project.bid_value }}</p>
            <p>
    <strong>Bid CM%:</strong>
    {{ (((project.bid_value - project.bid_cost) / project.bid_value)*100) | round(1) }}%
</p>
            <p>
    <strong>Impact Threshold:</strong>
    {% if project.impact_threshold == -1 %}-{% else %}{{ project.impact_threshold }}%{% endif %}
</p>
        </div>

        <h2>Risk Register</h2>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Classification</th>
                    <th>Type</th>
                    <th>Risk Type</th>
                    <th>Name</th>
                    <th>Description</th>
                    <th>Root Cause</th>
                    <th>WBS</th>
                    <th>Probability</th>
                    <th>Impact</th>
                    <th>Cost Impact</th>
                    <th>Most Likely Cost</th>
                    <th>Most Likely Days</th>
                    <th>Response Category</th>
                    <th>Response</th>
                    <th>Owner</th>
                    <th>Contingency Plan</th>
                    <th>Status</th>
                    <th>Last Updated</th>
                    <th>Tracking Comments</th>
                    <th>Change Order Covered</th>
                    <th>Change Order Revenue</th>
                    <th>Actual Cost Impact</th>
                    <th>Actual Schedule Impact</th>
                    <th>Variance Cost</th>
                    <th>Variance Days</th>
                    <th>Opportunity</th>
                    <th>Contingency Total</th>
                    <th>Cost Impact Variance</th>
                </tr>
            </thead>
            <tbody>
                {% for risk in project.risks %}
                <tr>
                    <td>{{ risk.date }}</td>
                    <td>{{ risk.classification }}</td>
                    <td>{{ risk.type }}</td>
                    <td>{{ risk.risk_type }}</td>
                    <td>{{ risk.name }}</td>
                    <td>{{ risk.description }}</td>
                    <td>{{ risk.root_cause }}</td>
                    <td>{{ risk.wbs }}</td>
                    <td>{{ risk.probability }}</td>
                    <td>{{ risk.impact }}</td>
                    <td>${{ risk.cost_impact }}</td>
                    <td>${{ risk.most_likely_cost }}</td>
                    <td>{{ risk.most_likely_days }}</td>
                    <td>{{ risk.response_category }}</td>
                    <td>{{ risk.response }}</td>
                    <td>{{ risk.owner }}</td>
                    <td>{{ risk.contingency_plan }}</td>
                    <td>{{ risk.status }}</td>
                    <td>{{ risk.last_updated }}</td>
                    <td>{{ risk.tracking_comments }}</td>
                    <td>{{ "Yes" if risk.change_order_covered else "No" }}</td>
                    <td>${{ risk.change_order_revenue }}</td>
                    <td>${{ risk.actual_cost_impact }}</td>
                    <td>{{ risk.actual_schedule_impact }}</td>
                    <td>${{ risk.variance_cost }}</td>
                    <td>{{ risk.variance_days }}</td>
                    <td>${{ risk.opportunity }}</td>
                    <td>${{ risk.contingency_total }}</td>
                    <td>${{ risk.cost_impact_variance }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <a href="/add_risk/{{ project.id }}" class="btn btn-primary">Add Risk</a>
    </div>
</body>
</html>
